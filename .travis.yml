sudo: required

language: cpp
#compiler:
# - gcc
# - clang

env:
  global:
  - BOOST_ROOT=$HOME/opt/boost_1_60_0

addons:
  apt:
    sources:
    - ubuntu-toolchain-r-test
    packages:
      - pv
      - make
      - autoconf
      - automake
      - cmake
      - gcc-5
      - g++-5
      - cpp-5
      - git
      - libbz2-dev
      - libsnappy-dev
      - libssl-dev
      - libtool
      - make
      - pkg-config
      - python3
      - python3-jinja2
      - doxygen
      - libncurses5-dev
      - libreadline-dev
      - perl
      - lcov

script:
- sh ciscripts/installboost.sh
- sh ciscripts/compiletest.sh

jobs:
  include:
  - stage: prepare cache
    script:
      - sh ciscripts/installboost.sh
      - sh ciscripts/compiletest.sh
  - stage: test
    script: ls -al .
  - stage: test
    script: ls -al build
  - stage: test
    script: ls -al build/*
  - stage: coverage
    script: sh ciscripts/collectcoverage.sh

cache:
  apt: true
  directories:
  - $BOOST_ROOT
  - boost_1_60_0
  - build